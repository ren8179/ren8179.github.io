(function(n){function i(n){var t=document.createElement("a");return t.href=n,{source:n,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,search:t.search,params:function(){for(var u={},i=t.search.replace(/^\?/,"").split("&"),f=i.length,n=0,r;n<f;n++)i[n]&&(r=i[n].split("="),u[r[0]]=r[1]);return u}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}}function t(n){if(n&&n.res&&n.res.length){this.debug=n.debug?!0:!1;this.imgList=[];this.cssList=[];this.jsList=[];for(var t in n.res)/\.css(\?{1}\S*)?$/.test(n.res[t])?this.cssList.push(n.res[t]):/\.js(\?{1}\S*)?$/.test(n.res[t])?this.jsList.push(n.res[t]):/\.(jpg|jpeg|png|gif)(\?{1}\S*)?$/.test(n.res[t])?this.imgList.push(n.res[t]):this.debug&&console.log("无效的loadUrl地址："+n.res[t]);this.loadCurr=[0,0,0];this.loadRecord=[0,0,0];this.loaded=0;this.length=this.imgList.length+this.cssList.length+this.jsList.length;this.urlCache=n.urlCache?!0:!1;this.onLoading=n.onLoading||undefined;this.onLoaded=n.onLoaded||undefined;this.onError=n.onError||undefined;this.delayLoaded=n.delayLoaded||undefined}}window.imgCache||(window.imgCache={},t.prototype.load=function(){(this.debug&&console.log("loader资源统计："+this.length+"\n img:"+this.imgList.length+", css:"+this.cssList.length+", js:"+this.jsList.length),this.loaded>=this.length)||(this.cssList.length>0?this.loadCss():this.imgList.length>0?this.loadImg():this.jsList.length>0&&this.loadJs())},t.prototype.loadImg=function(){var r=this,t,n;this.loadCurr[0]!=this.imgList.length&&(n=this.imgList[this.loadCurr[0]],n?(n=i(n),t=new Image,t.crossOrigin="*",t.onload=function(t){r._calculate(0,t.target.src);window.imgCache[n.file]=t.target},t.onerror=function(n){r._calculate(0,"错误---"+t.src,n)},t.src=this.urlCache?n.source:n.source+(n.search?"&":"?")+"r="+(new Date).getTime(),this.loadCurr[0]+=1):r._calculate(0,"错误---"+r.imgList[this.loadCurr[0]]))},t.prototype.loadCss=function(){var r=this,t,n;this.loadCurr[1]!=this.cssList.length&&(t=this.cssList[this.loadCurr[1]],t?(n=document.createElement("link"),t=i(t),n.type="text/css",n.rel="stylesheet",n.href=this.urlCache?t.source:t.source+(t.search?"&":"?")+"r="+(new Date).getTime(),n.onload=function(){r._calculate(1,n.href)},n.onerror=function(t){r._calculate(1,"错误---"+n.href,t)},document.head.appendChild(n),this.loadCurr[1]+=1):r._calculate(0,"错误---"+r.cssList[this.loadCurr[1]]))},t.prototype.loadJs=function(){var r=this,t,n;this.loadCurr[2]!=this.jsList.length&&(t=this.jsList[this.loadCurr[2]],t?(n=document.createElement("script"),t=i(t),n.type="text/javascript",n.src=this.urlCache?t.source:t.source+(t.search?"&":"?")+"r="+(new Date).getTime(),n.onload=function(){r._calculate(2,n.src)},n.onerror=function(t){r._calculate(2,"错误---"+n.src,t)},document.head.appendChild(n),r.loadCurr[2]+=1):r._calculate(0,"错误---"+r.jsList[this.loadCurr[2]]))},t.prototype._calculate=function(n,t,i){if(n!==undefined&&(!(t.indexOf("错误---")>=0)||typeof this.onError!="function"||this.onError(i))){this.loadRecord[n]+=1;this.loaded+=1;this.debug&&console.log("loader进度：["+this.loaded+"/"+this.length+"], 载入："+t);var u=this.loaded/this.length,r;if(typeof this.onLoading=="function"&&this.onLoading(u),u>=1){u=1;r=this.onLoaded;typeof r=="function"&&(typeof this.delayLoaded=="number"&&this.delayLoaded>0?setTimeout(function(){r()},this.delayLoaded):setTimeout(function(){r()}));return}this.loadCurr[1]<this.cssList.length?this.loadCss():this.loadRecord[1]==this.cssList.length&&this.loadCurr[0]<this.imgList.length?(this.loadImg(),this.loadImg()):this.loadRecord[0]==this.imgList.length&&this.loadCurr[2]<this.jsList.length&&this.loadJs()}},n.appLoad=function(){var n={res:[],debug:!1,delayLoad:0,delayLoaded:0,urlCache:!1,onLoading:undefined,onLoaded:undefined,onError:undefined},i;if(arguments.length){if(typeof arguments[0]=="object"&&arguments[0].length||typeof arguments[0]=="string")n.res=arguments[0],typeof arguments[1]=="function"&&(n.onLoading=arguments[1]),typeof arguments[2]=="function"&&(n.onLoaded=arguments[2]),typeof arguments[3]=="function"&&(n.onError=arguments[3]);else if(typeof arguments[0]=="object"&&arguments[0].res)for(i in n)arguments[0][i]&&(n[i]=arguments[0][i])}else return;n.res&&(typeof n.res=="string"&&(n.res=n.res.split(",")),typeof n.delayLoad=="number"&&n.delayLoad>0?setTimeout(function(){new t(n).load()},n.delayLoad):new t(n).load())})})(window);