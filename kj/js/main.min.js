function appStart(){function t(n,t){var i="";n===undefined&&(n="");n===null&&(n="null");typeof n=="boolean"&&(n=n?"true":"false");i+='<div class="alert"><article>';i+="<header>"+n+"<\/header>";i+="<footer><a>确定<\/a><\/footer>";i+="<\/article><\/div>";i=$(i);i.find("footer").one(app.evtClick,function(){var n=$(this).closest(".alert");n.addClass("alert_out").one("webkitAnimationEnd",function(){$(this).remove();typeof t=="function"&&t()})});$(".app").append(i)}function i(n){var t=$(".loading");if(t.length){t.removeClass("loading_out").off("webkitAnimationEnd");return}if(t=$('<div class="loading"><center><i><\/i><\/center><\/div>'),$(".app").append(t),typeof n=="function")t.one("webkitAnimationEnd",function(){n()})}function r(n){var t=$(".loading");if(t.length)t.addClass("loading_out").one("webkitAnimationEnd",function(){($(this).remove(),typeof n=="function")&&setTimeout(n,100)})}function n(n,t,i){var r=$(".app>section:visible"),u=$(n);u.is(r)||(r.length&&r.addClass("no_animation").transit({y:t?"100%":"-100%"},300,function(){$(this).removeClass("no_animation").removeAttr("style")}),u.css({display:"block",y:t?"-100%":"100%"}).addClass("no_animation").transit({y:0},300,function(){$(this).removeClass("no_animation");typeof i=="function"&&i()}))}function f(n){var i,r,t;for(n!=1&&n!=2&&(n=1),i="",t=1;t<=5;t++)i+="<ul>",r=app.poster.items[t-1][n-1],$.each(r,function(){i+='<li style="background-image: url(img/item'+t+"/i"+t+"-"+this+'s.png);" data-img="i'+t+"-"+this+'.png"><\/li>'}),i+="<\/ul>";$(".s2 menu>div").html(i);$(".s2 menu ul:eq(0) li:eq(0), .s2 menu ul:eq(1) li:eq(0), .s2 menu ul:eq(2) li:eq(0)").trigger("click")}function u(n){var e,h,t,s,o,f=[0],c=!0;(i(),$(".s2 menu ul").each(function(t){return t+=1,h=parseInt($(".s2 figure .item"+t).css("z-index"))||0,f.push({id:$(this).find("li.curr").attr("data-img"),lv:h,img:undefined}),f[t].id&&(f[t].img=window.imgCache[f[t].id],!f[t].img)?(setTimeout(function(){u(n)},300),c=!1,!1):void 0}),c)&&(f.sort(function(n,t){return n.lv-t.lv}),o=window.imgCache[$(".s2 figure").is(".role2")?"role2.png":"role1.png"],t=document.createElement("canvas"),t.width=o.naturalWidth,t.height=o.naturalHeight,s=t.getContext("2d"),s.drawImage(o,0,0),$.each(f,function(){this.img&&s.drawImage(this.img,0,0,t.width,t.height)}),e=new Image,e.onload=function(){r();setTimeout(function(){typeof n=="function"&&n(e)},100)},e.src=t.toDataURL())}function e(){var t="",n;for(t+="<ul>",n=1;n<=app.poster.bg;n++)t+='<li style="background-image: url(img/bg/bg-'+n+'s.png);" data-img="bg-'+n+'.png"><\/li>';t+="<\/ul>";$(".s3 menu>div").html(t);$(".s3 menu ul:eq(0) li:eq(0)").trigger("click")}function o(n){var a=window.imgCache[$(".s3 menu ul:eq(0) li.curr").attr("data-img")],v="#fff",f=app.poster.role,h=window.imgCache["title.png"],y=window.imgCache["title2.png"],p=window.imgCache["ewm.png"],e,o,t,u,s,c,l;a&&f&&(i(),l=function(){r();setTimeout(function(){typeof n=="function"&&n(e,o)},100)},t=document.createElement("canvas"),t.width=h.naturalWidth,t.height=h.naturalHeight,u=t.getContext("2d"),u.fillStyle=v,u.fillRect(0,0,t.width,t.height),u.drawImage(a,0,0),u.drawImage(f,0,0,f.naturalWidth,f.naturalHeight,t.width*.15,t.width*.07,t.width*.7,t.width*1.286),u.drawImage(h,0,0),u.textBaseline="top",u.fillStyle="#111",u.font="bold 25px arial",s=app.poster.label+"\n\n是我",c=(t.width-u.measureText(s).width)*.5,u.fillText(s,c,25),u.font="bold 12px arial",s="我是\n\n"+app.poster.name,u.fillText(s,c,54),e=new Image,o=new Image,$("body").append(e),$("body").append(o),e.onload=function(){e.loaded=!0;o.loaded&&l()},e.src=t.toDataURL("image/jpeg",.9),t.width=f.naturalWidth,t.height=f.naturalWidth,u.fillStyle=v,u.fillRect(0,0,t.width,t.height),u.drawImage(y,0,0),u.drawImage(f,0,-25),o.onload=function(){o.loaded=!0;e.loaded&&l()},o.src=t.toDataURL("image/jpeg",.9))}if(window.app&&window.$){app.evtDown=app.isTOUCH?"touchstart":"mousedown";app.evtUp=app.isTOUCH?"touchend":"mouseup";app.evtClick=app.isTOUCH?"tap":"click";$.event.special.tap={setup:function(){$(this).on("touchstart.tap",function(n){$(this).data("@tap_startTime",n.timeStamp)});$(this).on("touchmove.tap",function(){$(this).removeData("@tap_startTime")});$(this).on("touchend.tap",function(n){if($(this).data("@tap_startTime")&&n.timeStamp-$(this).data("@tap_startTime")<800){$(this).removeData("@tap_startTime");var t=$.Event("tap");t.originalEvent=n.originalEvent;setTimeout(function(){$.event.trigger(t,null,n.target)},100)}})},teardown:function(){$(this).off("touchstart.tap").off("touchmove.tap").off("touchend.tap");$.event.remove(this,"tap");$.removeData(this,"@tap_startTime")}};$.event.special.slide={setup:function(){$(this).on(app.evtDown+".slide",function(n){$(this).data("@slide_startTime",n.timeStamp);$(this).data("@slide_startX",n.pageX||n.originalEvent.changedTouches[0].pageX);$(this).data("@slide_startY",n.pageY||n.originalEvent.changedTouches[0].pageY)});$(this).on(app.evtUp+".slide",function(n){var e=$(this).data("@slide_startX"),o=$(this).data("@slide_startY"),t=n.pageX||n.originalEvent.changedTouches[0].pageX,i=n.pageY||n.originalEvent.changedTouches[0].pageY,s=$(this).data("@slide_startTime"),r,f,u=30;($(this).removeData("@slide_startX").removeData("@slide_startY").removeData("@slide_startTime"),typeof s!="number"||n.timeStamp-s>1e3)||typeof e=="number"&&typeof t=="number"&&typeof o=="number"&&typeof i=="number"&&(t=t-e,i=i-o,Math.abs(t)>Math.abs(i)?t>u?r="right":t<-u&&(r="left"):i>u?r="down":i<-u&&(r="up"),r&&(f=$.Event("slide"),f.slideType=r,$.event.trigger(f,null,n.target)))})},teardown:function(){$.event.remove(this,"slide");$(this).off(app.evtDown+".slide").off(app.evtUp+".slide");$(this).removeData("@slide_startX").removeData("@slide_startTime")}};$(".s1 h3 a").on(app.evtClick,function(){$(this).is(".curr")||($(this).addClass("curr").siblings("a").removeClass("curr"),app.poster.sex=$(this).index()==0?1:2)});$(".s1 h4 a").on(app.evtClick,function(){if(!app.poster.sex){t("请先选择性别！");return}$(".s2 figure").attr("class","role"+app.poster.sex).children("p").removeAttr("style");$(".s2 ol").removeClass("selected").children("li").removeClass("curr");$(".s2 menu").hide();f(app.poster.sex);n(".s2")});app.itemScroll=new IScroll($(".s2 menu")[0],{click:!0});$(".s2 ol").on(app.evtClick,"li a",function(){var n=$(this).parent();if(n.is(".curr")){$(".s2 footer .btn1").trigger(app.evtClick);return}n.addClass("curr").parent("ol").addClass("selected");$(".s2 footer a.btn1").text("返回分类");$(".s2 menu").show().find("ul").hide().eq(n.index()).show();app.itemScroll.refresh();app.itemScroll.scrollTo(0,0,0)});$(".s2 menu").on("click","li",function(){var n;if(!$(this).hasClass("off")){if(n=$(this).parent().index()+1,$(this).is(".curr")){$(this).removeClass("curr");$(".s2 figure .item"+n).removeAttr("style");n<=3&&$(this).parent().children(":eq(0)").trigger("click");return}var i=$(this).attr("data-img"),r="img/item"+n+"/"+i,t=i.replace(".png","").split("-")[1],u=function(){var i,f,u=$(".s2 figure .item"+n);u.attr("style","background-image: url("+r+")");n-=1;app.poster.exLevel[n]&&app.poster.exLevel[n][t]&&u.css("z-index",app.poster.exLevel[n][t]);(n==1||n==2)&&(u=$(".s2 figure .item3"),f=$(".s2 menu ul:eq(2) li.curr").attr("data-img"),f&&(f=f.replace(".png","").split("-")[1]),app.poster.exLevel[2][f]?u.css("z-index",app.poster.exLevel[2][f]):u[0].preZindex&&(u.css("z-index",u[0].preZindex),u[0].preZindex=undefined),n==2&&app.poster.exPants[t]?(i=$(".s2 menu ul:eq(1) li.curr").attr("data-img"),i&&(i=i.replace(".png","").split("-")[1],app.poster.exPants.aboutCost[i]?(u[0].preZindex=u.css("z-index"),u.css("z-index",app.poster.exPants[t])):i=0)):n==1&&app.poster.exPants.aboutCost[t]&&(i=$(".s2 menu ul:eq(2) li.curr").attr("data-img"),i&&(i=i.replace(".png","").split("-")[1],app.poster.exPants[i]?(u[0].preZindex=u.css("z-index"),u.css("z-index",app.poster.exPants[i])):i=0)));(n==3||n==2||n==1)&&(u=$(".s2 figure .item4"),f=$(".s2 menu ul:eq(3) li.curr").attr("data-img"),f&&(f=f.replace(".png","").split("-")[1]),app.poster.exLevel[3][f]?u.css("z-index",app.poster.exLevel[3][f]):u[0].preZindex&&(u.css("z-index",u[0].preZindex),u[0].preZindex=undefined),i=$(".s2 menu ul:eq(2) li.curr").attr("data-img"),i&&f&&(i=i.replace(".png","").split("-")[1],app.poster.exPants[i]&&!app.poster.exLevel[3][f]&&(u[0].preZindex=u.css("z-index"),u.css("z-index",app.poster.exPants[i]+1))));(n==1||n==4)&&(u=$(".s2 figure .item5"),u[0].preZindex&&(u.css("z-index",app.poster.exLevel[4][t]&&app.poster.exLevel[4][t]>u[0].preZindex?app.poster.exLevel[4][t]:u[0].preZindex),u[0].preZindex=undefined),n==4&&app.poster.exAcc[t]?(i=$(".s2 menu ul:eq(1) li.curr").attr("data-img"),i&&(i=i.replace(".png","").split("-")[1],app.poster.exAcc.aboutCost[i]&&(u[0].preZindex=u.css("z-index"),u.css("z-index",app.poster.exAcc[t])))):n==1&&app.poster.exAcc.aboutCost[t]&&(i=$(".s2 menu ul:eq(4) li.curr").attr("data-img"),i&&(i=i.replace(".png","").split("-")[1],app.poster.exAcc[i]&&(u[0].preZindex=u.css("z-index"),u.css("z-index",app.poster.exAcc[i])))));n==4&&($(".s2 menu ul:eq(4)")[0].preCurr=undefined);n==1&&(app.poster.exCost[t]?$.each(app.poster.exCost[t],function(n,t){i=$(".s2 menu ul:eq("+(n-1)+")");t.isoff||i.children("li").addClass("off");$.each(t.ids,function(r,u){i.find("li[data-img='i"+n+"-"+u+".png']").toggleClass("off",t.isOff?!0:!1)});i.children("li.curr").hasClass("off")&&($(".s2 figure .item"+n).css("background-image","none"),i[0].preCurr=i.children("li.curr").index(),i.children("li.curr").removeClass("curr"));n!=1||i.children("li.curr").length||i.children("li").not(".off").eq(0).trigger("click")}):$.each(app.poster.exCost,function(n,t){$.each(t,function(n){i=$(".s2 menu ul:eq("+(n-1)+")");i.children("li").removeClass("off");typeof i[0].preCurr=="number"&&i[0].preCurr>=0&&i.children("li:eq("+i[0].preCurr+")").trigger("click");i[0].preCurr=undefined})}))};$(this).addClass("curr").siblings().removeClass("curr");u();window.imgCache[i]||appLoad([r])}});$(".s2 footer a").on(app.evtClick,function(){$(this).is(".btn1")?$(this).text()=="返回分类"?($(this).text("返回"),$(".s2 menu").hide(),$(".s2 ol").removeClass("selected").children("li").removeClass("curr")):n(".s1",!0):$(this).is(".btn2")&&($(".s3 menu ul").length||e(),u(function(t){app.poster.role=t;$(".s3 figure .role").css("background-image","url("+t.src+")");$(".s3 footer h4 a").removeAttr("curr").eq(0).addClass("curr");$(".s3 footer menu ul").hide().eq(0).show();n(".s3",!1,function(){app.bgScroll.refresh();app.bgScroll.scrollTo(0,0,0)})}))});app.bgScroll=new IScroll($(".s3 menu")[0],{click:!0,scrollY:!1,scrollX:!0});$(".s3 header a").on(app.evtClick,function(){n(".s2",!0)});$(".s3 menu").on("click","li",function(){if(!$(this).is(".curr")){var n=$(this).attr("data-img");$(".s3 figure .bg").css("background-image","url(img/bg/"+$(this).attr("data-img")+")");$(this).addClass("curr").siblings().removeClass("curr")}});$(".s3 figure .name").on(app.evtClick,function(){$(".s3>center").show()});$(".s3>center a").on(app.evtClick,function(){if(app.poster.label=$(".s3>center input:eq(0)").val().trim(),app.poster.name=$(".s3>center input:eq(1)").val().trim(),app.poster.label){if(!app.poster.name){t("请填写您的想法！");return}}else{t("请填写您的昵称！");return}($(".s3 figure .name font:eq(0)").text()!=app.poster.label||$(".s3 figure .name font:eq(1)").text()!=app.poster.name)&&(app.poster.wordCheck=!1);$(".s3 figure .name font:eq(0)").text(app.poster.label);$(".s3 figure .name font:eq(1)").text(app.poster.name);$(".s3>center").hide()});$(".s3 footer h3 a").on(app.evtClick,function(){if(!app.poster.label||!app.poster.name){t("请填写您的昵称或想法！");return}o(function(t,i){app.poster.img1=t;app.poster.img2=i;$(".s4 figure img, .s4 .btn3 img, .s5 .btn3 img").remove();$(".s4 figure, .s4 .btn3").append(t);$(".s5 figure, .s5 .btn3").append(i);n(".s4")})});$(".s4 .btn6").on(app.evtClick,function(){n(".s3",!0)});$(".s4 .btn4").on(app.evtClick,function(){n(".s5")});$(".s5 .btn1").on(app.evtClick,function(){n(".s4",!0)});$(".s4 .btn5, .s5 .btn5").on(app.evtClick,function(){$(".share").css({display:"block",y:"8%",opacity:0}).transit({y:0,opacity:1},200,function(){$(this).one(app.evtClick,function(){$(this).transit({y:"8%",opacity:0},200,function(){$(this).removeAttr("style")})})})});$(".load").addClass("no_animation").transit({opacity:0},400,"linear",function(){$(this).remove();$(".s1").css({display:"block",opacity:0}).transit({opacity:1},400,"linear")})}}